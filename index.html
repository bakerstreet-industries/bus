<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>@node-ts/bus | @node-ts/bus</title>
    <meta name="description" content="Enterprise message bus library for typescript">
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-139036417-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-139036417-1');
    </script>
    
    <link rel="preload" href="/bus/assets/css/0.styles.a0567244.css" as="style"><link rel="preload" href="/bus/assets/js/app.9b9c970b.js" as="script"><link rel="preload" href="/bus/assets/js/2.40db6fc8.js" as="script"><link rel="preload" href="/bus/assets/js/5.13b1a726.js" as="script"><link rel="prefetch" href="/bus/assets/js/10.da946e8a.js"><link rel="prefetch" href="/bus/assets/js/11.f7b4aa18.js"><link rel="prefetch" href="/bus/assets/js/12.aa407c4a.js"><link rel="prefetch" href="/bus/assets/js/13.36afd7f4.js"><link rel="prefetch" href="/bus/assets/js/14.44c52693.js"><link rel="prefetch" href="/bus/assets/js/15.18967a22.js"><link rel="prefetch" href="/bus/assets/js/16.d53fa3bb.js"><link rel="prefetch" href="/bus/assets/js/17.456ac79b.js"><link rel="prefetch" href="/bus/assets/js/18.fb92a928.js"><link rel="prefetch" href="/bus/assets/js/19.39fc7cc9.js"><link rel="prefetch" href="/bus/assets/js/20.1674d02d.js"><link rel="prefetch" href="/bus/assets/js/21.b2f3dc85.js"><link rel="prefetch" href="/bus/assets/js/22.153c6055.js"><link rel="prefetch" href="/bus/assets/js/23.5cd90b86.js"><link rel="prefetch" href="/bus/assets/js/24.930648bb.js"><link rel="prefetch" href="/bus/assets/js/25.2f9a4e57.js"><link rel="prefetch" href="/bus/assets/js/26.0b3967e8.js"><link rel="prefetch" href="/bus/assets/js/27.6d0990f4.js"><link rel="prefetch" href="/bus/assets/js/28.fe213cf5.js"><link rel="prefetch" href="/bus/assets/js/29.c9a1d805.js"><link rel="prefetch" href="/bus/assets/js/3.ad62bd45.js"><link rel="prefetch" href="/bus/assets/js/30.d658eac0.js"><link rel="prefetch" href="/bus/assets/js/31.ee0536bc.js"><link rel="prefetch" href="/bus/assets/js/32.67be88d4.js"><link rel="prefetch" href="/bus/assets/js/33.ec397c9a.js"><link rel="prefetch" href="/bus/assets/js/34.16465bea.js"><link rel="prefetch" href="/bus/assets/js/35.5f7522c2.js"><link rel="prefetch" href="/bus/assets/js/36.fc380b80.js"><link rel="prefetch" href="/bus/assets/js/37.0a8285aa.js"><link rel="prefetch" href="/bus/assets/js/38.0467eb59.js"><link rel="prefetch" href="/bus/assets/js/39.4cb19319.js"><link rel="prefetch" href="/bus/assets/js/4.14653418.js"><link rel="prefetch" href="/bus/assets/js/40.304ab5a1.js"><link rel="prefetch" href="/bus/assets/js/41.69b46a27.js"><link rel="prefetch" href="/bus/assets/js/42.39ba8e37.js"><link rel="prefetch" href="/bus/assets/js/43.9085c1f3.js"><link rel="prefetch" href="/bus/assets/js/44.be17aea7.js"><link rel="prefetch" href="/bus/assets/js/45.204a2c48.js"><link rel="prefetch" href="/bus/assets/js/6.a563d3f5.js"><link rel="prefetch" href="/bus/assets/js/7.074f2c3e.js"><link rel="prefetch" href="/bus/assets/js/8.397fdcaa.js"><link rel="prefetch" href="/bus/assets/js/9.52cf5dbe.js">
    <link rel="stylesheet" href="/bus/assets/css/0.styles.a0567244.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/bus/" class="home-link router-link-exact-active router-link-active"><!----> <span class="site-name">@node-ts/bus</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/bus/" class="nav-link router-link-exact-active router-link-active">Home</a></div><div class="nav-item"><a href="/bus/packages/bus-core/src/handler/" class="nav-link">Handlers</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Transports</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-sqs/" class="nav-link">SQS</a></li><li class="dropdown-item"><!----> <a href="/bus/packages/bus-rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></div></div><div class="nav-item"><a href="/bus/packages/bus-workflow/" class="nav-link">Workflows</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Persistence</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-postgres/" class="nav-link">Postgres</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/node-ts/bus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/bus/" class="nav-link router-link-exact-active router-link-active">Home</a></div><div class="nav-item"><a href="/bus/packages/bus-core/src/handler/" class="nav-link">Handlers</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Transports</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-sqs/" class="nav-link">SQS</a></li><li class="dropdown-item"><!----> <a href="/bus/packages/bus-rabbitmq/" class="nav-link">RabbitMQ</a></li></ul></div></div><div class="nav-item"><a href="/bus/packages/bus-workflow/" class="nav-link">Workflows</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Persistence</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/bus/packages/bus-postgres/" class="nav-link">Postgres</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/node-ts/bus" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/bus/" class="active sidebar-link">Home</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bus/#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/bus/#getting-started" class="sidebar-link">Getting Started</a></li><li class="sidebar-sub-header"><a href="/bus/#components" class="sidebar-link">Components</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/bus/#message-handlers" class="sidebar-link">Message Handlers</a></li><li class="sidebar-sub-header"><a href="/bus/#workflows" class="sidebar-link">Workflows</a></li><li class="sidebar-sub-header"><a href="/bus/#transports" class="sidebar-link">Transports</a></li></ul></li></ul></li><li><a href="/bus/packages/bus-messages/" class="sidebar-link">Messages</a></li><li><a href="/bus/packages/bus-core/src/handler/" class="sidebar-link">Handlers</a></li><li><a href="/bus/packages/bus-core/src/transport/" class="sidebar-link">Transports</a></li><li><a href="/bus/packages/bus-workflow/" class="sidebar-link">Workflows</a></li><li><a href="/bus/packages/bus-workflow/src/workflow/persistence/" class="sidebar-link">Persistence</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="node-ts-bus"><a href="#node-ts-bus" aria-hidden="true" class="header-anchor">#</a> @node-ts/bus</h1> <br> <p><strong>ðŸ”¥ v0.x of @node-ts/bus is deprecated. For the latest version visit <a href="https://node-ts.gitbook.io/bus/" target="_blank" rel="noopener noreferrer">https://node-ts.gitbook.io/bus/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ðŸ”¥</strong></p> <br> <hr> <p><strong>A service bus for message-based, distributed node applications.</strong></p> <p><a href="https://greenkeeper.io/" target="_blank" rel="noopener noreferrer"><img src="https://badges.greenkeeper.io/node-ts/bus.svg" alt="Greenkeeper badge"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <a href="https://circleci.com/gh/node-ts/bus/tree/master" target="_blank" rel="noopener noreferrer"><img src="https://circleci.com/gh/node-ts/bus/tree/master.svg?style=svg" alt="CircleCI"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a><a href="https://opensource.org/licenses/MIT" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/badge/License-MIT-green.svg" alt="License: MIT"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <iframe src="https://ghbtns.com/github-btn.html?user=node-ts&amp;repo=bus&amp;type=star&amp;count=true" frameborder="0" scrolling="0" width="80px" height="20px"></iframe> <iframe src="https://ghbtns.com/github-btn.html?user=node-ts&amp;repo=bus&amp;type=watch&amp;count=true&amp;v=2" frameborder="0" scrolling="0" width="170px" height="20px"></iframe></p> <p>View our docs at <a href="https://node-ts.github.io/bus/" target="_blank" rel="noopener noreferrer">https://node-ts.github.io/bus/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h2 id="overview"><a href="#overview" aria-hidden="true" class="header-anchor">#</a> Overview</h2> <p>This framework provides a way to connect different applications or parts of the same application together in a developer-friendly way powered by message queues. It helps to decouple and greatly simplify applications, especially as they grow larger.</p> <p>The simplest way to imagine a message based system is the following:</p> <ul><li>Your system, as a whole, can accept and process <code>commands</code></li> <li>When a command is executed, one or more <code>events</code> are published</li> <li>The system can listen for certain <code>events</code> and trigger other <code>commands</code> because of it</li></ul> <p>For example consider an online hotel booking message based system:</p> <ul><li>A <code>command</code> like <code>ReserveRoom</code> is sent when a new reservation is made</li> <li>Upon processing this <code>command</code>, a <code>RoomReserved</code> event is published</li> <li>Whenever a <code>RoomReserved</code> <code>event</code> is received, a <code>SendEmailToHotel</code> <code>command</code> is sent</li></ul> <p>This library can be combined with the Domain Driven Design library <a href="https://www.github.com/node-ts/ddd" target="_blank" rel="noopener noreferrer">@node-ts/ddd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> that helps align software with the business domain.</p> <h2 id="getting-started"><a href="#getting-started" aria-hidden="true" class="header-anchor">#</a> Getting Started</h2> <p>The fastest way to get started with this service bus is to clone the starter project at <a href="https://github.com/node-ts/bus-starter" target="_blank" rel="noopener noreferrer">@node-ts/bus-starter<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>.</p> <h2 id="components"><a href="#components" aria-hidden="true" class="header-anchor">#</a> Components</h2> <p>This library consists of the following main components:</p> <h3 id="message-handlers"><a href="#message-handlers" aria-hidden="true" class="header-anchor">#</a> Message Handlers</h3> <p>Message handlers are simple, stateless functions that are invoked each time a message that your application subscribes to is received. They take the message as an argument, perform an action based on the message, and then complete.</p> <p>Messages can be sent using <code>bus.send()</code> for commands and <code>bus.publish()</code> for events (see <a href="/bus/packages/bus-messages/">@node-ts/bus-messages</a> for more information about the two). For example:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> inject<span class="token punctuation">,</span> injectable <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'inversify'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> Bus<span class="token punctuation">,</span> <span class="token constant">BUS_SYMBOLS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@node-ts/bus-core'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> ReserveRoom<span class="token punctuation">,</span> ProgramCompleted <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./messages'</span>

@<span class="token function">injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Program</span> <span class="token punctuation">{</span>
  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>
    <span class="token parameter">@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token constant">BUS_SYMBOLS</span><span class="token punctuation">.</span>Bus<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> bus<span class="token punctuation">:</span> Bus</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">run</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bus<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReserveRoom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bus<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ProgramCompleted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>Here's a simple message handler that will execute the <code>ReserveRoom</code> command that was sent above. By declaring a class with <code>HandlesMessage</code>, this framework will automatically take care of configuring the underlying message transport. It doesn't matter where the command is sent from, or which application has this handler - the message will arrive.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>@<span class="token function">HandlesMessage</span><span class="token punctuation">(</span>ReserveRoom<span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ReserveRoomHandler</span> <span class="token punctuation">{</span>
  <span class="token function">handles</span> <span class="token punctuation">(</span>command<span class="token punctuation">:</span> ReserveRoom<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
    roomService<span class="token punctuation">.</span><span class="token function">reserve</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For more information on handlers, see <a href="/bus/packages/bus-core/src/handler/">@node-ts/bus-core/handlers</a></p> <p>For more information on message types, see <a href="/bus/packages/bus-messages/">@node-ts/bus-messages</a></p> <h3 id="workflows"><a href="#workflows" aria-hidden="true" class="header-anchor">#</a> Workflows</h3> <p>Workflows orchestrate the business process logic in your application. Business processes are specific to your application and problem domain, and can be anything from carrying out the steps of an eCommerce site to process an order through to fulfilment, to managing a marketing campaign from start to finish.</p> <p>Workflows are crucial in decoupling your application and keeping the <em><strong>how to do something</strong></em> separate from the <em><strong>when to do something</strong></em>.</p> <p>Consider the following business process that sends emails to the hotel, and then the customer when a hotel room is reserved:</p> <p><img src="/bus/assets/img/workflow.b5a41b85.png" alt="Room Reservation Workflow"></p> <p>Writing this process as a workflow is simple and resilient:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">ReservationWorkflow</span> <span class="token keyword">extends</span> <span class="token class-name">Workflow</span><span class="token operator">&lt;</span>ReservationWorkflowData<span class="token operator">&gt;</span> <span class="token punctuation">{</span>

  <span class="token keyword">constructor</span> <span class="token punctuation">(</span>
    <span class="token parameter">@<span class="token function">inject</span><span class="token punctuation">(</span><span class="token constant">BUS_SYMBOLS</span><span class="token punctuation">.</span>Bus<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">readonly</span> bus<span class="token punctuation">:</span> Bus</span>
  <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Start a new ReservationWorkflow each time a `RoomReserved` event is published
   */</span>
  @StartedBy<span class="token operator">&lt;</span>RoomReserved<span class="token punctuation">,</span> ReservationWorkflowData<span class="token punctuation">,</span> <span class="token string">'handleRoomReserved'</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>RoomReserved<span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">handleRoomReserved</span> <span class="token punctuation">(</span>roomReserved<span class="token punctuation">:</span> RoomReserved<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Partial<span class="token operator">&lt;</span>ReservationWorkflowData<span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Notify the hotel that the room was reserved</span>
    <span class="token keyword">const</span> notifyHotel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendEmailToHotel</span><span class="token punctuation">(</span>
      roomReserved<span class="token punctuation">.</span>roomId<span class="token punctuation">,</span>
      roomReserved<span class="token punctuation">.</span>fromDate<span class="token punctuation">,</span>
      roomReserved<span class="token punctuation">.</span>toDate
    <span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bus<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>notifyHotel<span class="token punctuation">)</span>

    <span class="token comment">// Add the room id to the workflow state</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      customerId<span class="token punctuation">:</span> roomReserved<span class="token punctuation">.</span>customerId<span class="token punctuation">,</span>
      roomId<span class="token punctuation">:</span> roomReserved<span class="token punctuation">.</span>roomId
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * Once the email has been sent to the hotel notifying them of the booking, send the
   * itinerary to the customer.
   */</span>
  @Handles<span class="token operator">&lt;</span>EmailSentToHotel<span class="token punctuation">,</span> ReservationWorkflowData<span class="token punctuation">,</span> <span class="token string">'handleEmailSentToHotel'</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>EmailSentToHotel<span class="token punctuation">,</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span> event<span class="token punctuation">.</span>roomId<span class="token punctuation">,</span> <span class="token string">'roomId'</span><span class="token punctuation">)</span>
  <span class="token keyword">async</span> <span class="token function">handleEmailSentToHotel</span> <span class="token punctuation">(</span>event<span class="token punctuation">:</span> EmailSentToHotel<span class="token punctuation">,</span> data<span class="token punctuation">:</span> ReservationWorkflowData<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span>Partial<span class="token operator">&lt;</span>ReservationWorkflowData<span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// The current workflow state is injected into each handler</span>
    <span class="token keyword">const</span> sendItineraryToCustomer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SendItineraryToCustomer</span><span class="token punctuation">(</span>
      data<span class="token punctuation">.</span>customerId<span class="token punctuation">,</span>
      data<span class="token punctuation">.</span>roomId
    <span class="token punctuation">)</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>bus<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>sendItineraryToCustomer<span class="token punctuation">)</span>

    <span class="token comment">// Nothing left to do for this workfow, so mark it as complete</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">complete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><p>This workflow coordinates a number of different systems without any knowledge of where they are or how they work. It does no work except to orchestrate individual actions (commands) to perform a larger process.</p> <p>For more information, see <a href="/bus/packages/bus-workflow/">@node-ts/bus-workflow</a></p> <h3 id="transports"><a href="#transports" aria-hidden="true" class="header-anchor">#</a> Transports</h3> <p>Transports are message brokers that are use by this library for communication. RabbitMQ, AWS SQS, Kafka, MSMQ etc are all examples of message queueing technology that can be used. The choice of transport is largely irrelevant for the developer, as this library abstracts all of those complexities away.</p> <p>Currently transport adapters for RabbitMQ and AWS SQS have been written, but implementing one for a different technology is simple.</p> <p>For more information, see <a href="/bus/packages/bus-core/src/transport/">@node-ts/bus-core/transport</a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/bus/packages/bus-messages/">Messages</a>â†’
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/bus/assets/js/app.9b9c970b.js" defer></script><script src="/bus/assets/js/2.40db6fc8.js" defer></script><script src="/bus/assets/js/5.13b1a726.js" defer></script>
  </body>
</html>
